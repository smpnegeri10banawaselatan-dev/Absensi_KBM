<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Data Kehadiran</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen p-6">
  <div class="max-w-6xl mx-auto bg-white shadow-lg rounded-lg p-6">
    <h1 class="text-3xl font-bold mb-4 text-indigo-600 flex items-center justify-center">
      <i class="bi bi-people-fill mr-2"></i> Data Kehadiran Peserta
    </h1>
    
    <div class="mb-4 text-right">
      <button onclick="exportToPDF()" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">
        <i class="bi bi-file-earmark-pdf mr-1"></i> Export PDF
      </button>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full border border-gray-300">
        <thead class="bg-indigo-100 text-indigo-700">
          <tr id="table-header"></tr>
        </thead>
        <tbody id="table-body" class="bg-white divide-y divide-gray-200"></tbody>
      </table>
    </div>
  </div>

  <script>
    const sheetId = '13sHi-bSW-lkITVSrx2-YWtanLutcD_WNzTywo93C3Jo';
    const sheetName = 'kehadiran';
    const apiKey = 'AIzaSyBk6jIQ04ivWuWwTBPBVLtCRnneaTSf8V4';
    const apiURL = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}?key=${apiKey}`;

    fetch(apiURL)
      .then(res => res.json())
      .then(data => {
        const headers = data.values[0];
        const rows = data.values.slice(1);

        const thead = document.getElementById('table-header');
        const tbody = document.getElementById('table-body');

        headers.forEach(header => {
          const th = document.createElement('th');
          th.textContent = header;
          th.className = 'px-4 py-2 text-left font-semibold border';
          thead.appendChild(th);
        });

        rows.forEach(row => {
          const tr = document.createElement('tr');

          row.forEach((cell, i) => {
            const td = document.createElement('td');
            td.className = 'px-4 py-2 border';

            if (headers[i].toLowerCase() === 'foto') {
              const btn = document.createElement('button');
              btn.className = 'text-blue-600 hover:text-blue-800 flex items-center';
              btn.innerHTML = '<i class="bi bi-eye"></i>';
              btn.onclick = () => {
                const win = window.open('', '_blank', 'width=300,height=400');
                win.document.write(`<img src="${cell}" alt="Foto 3x4" style="width:225px;height:300px;">`);
              };
              td.appendChild(btn);
            } else {
              td.textContent = cell;
            }

            tr.appendChild(td);
          });

          tbody.appendChild(tr);
        });
      })
      .catch(error => {
        console.error('Gagal memuat data:', error);
        alert('Gagal memuat data. Pastikan API Key dan akses file Sheets sudah benar.');
      });

    function exportToPDF() {
      const pdf = new jspdf.jsPDF();
      html2canvas(document.querySelector("table")).then(canvas => {
        const imgData = canvas.toDataURL("image/png");
        const pageWidth = pdf.internal.pageSize.getWidth();
        const ratio = canvas.width / canvas.height;
        const imgHeight = pageWidth / ratio;
        pdf.addImage(imgData, "PNG", 10, 10, pageWidth - 20, imgHeight);
        pdf.save("data-kehadiran.pdf");
      });
    }
  </script>
</body>
</html>
